<template component>
  <style>
    ul {
      overflow-y: auto;
      height: 100%;
      padding: 0;
      margin: 0;
    }

    li {
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      font-size: 14px;
      cursor: pointer;
      padding: 6px;
      border-radius: 6px;
      border-bottom: 1px solid #e6e6e6;

      &:hover {
        background-color: #f5f5f5;
      }
    }

    .dark li {
      &:hover {
        background-color: rgba(255, 255, 255, 0.1);
      }
    }

    .is-active {
      color: #0073ff;
    }
  </style>

  <ul attr:class="store.theme">
    <x-fill :value="store.menus">
      <li attr:class="$host.store.currTitle === $data ? 'is-active' : ''" on:click="$host.toggle($data)"
        attr:title="$data.replace('.js', '')">
        {{$data.replace('.js', '')}}</li>
    </x-fill>
  </ul>

  <script>
    import { getText, stringToDom, getUrl } from '../js/util.js'

    export default async function ({ load }) {
      const { data } = await load('../js/store.js')
      return {
        tag: 'l-menu',
        data: {
          store: {},
        },
        attached() {
          this.store = data
        },
        detached() {
          this.store = null
        },
        async loaded() {
          const html = await getText(getUrl('questionBank'), fetch)
          console.log(`ðŸš€ ~ html:`, html);

          // const dom = stringToDom(html);
          this.store.menus = [
            "1.ä¸¤æ•°ä¹‹å’Œ.js",
            "2.ä¸¤æ•°ç›¸åŠ .js",
            "3.æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸².js",
            "69.x-çš„å¹³æ–¹æ ¹.js",
            "88.åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„.js",
            "263.ä¸‘æ•°.js",
            "268.ä¸¢å¤±çš„æ•°å­—.js",
            "414.ç¬¬ä¸‰å¤§çš„æ•°.js",
            "575.åˆ†ç³–æžœ.js",
            "846.ä¸€æ‰‹é¡ºå­.js",
            "944.åˆ åˆ—é€ åº.js",
            "976.ä¸‰è§’å½¢çš„æœ€å¤§å‘¨é•¿.js",
            "1122.æ•°ç»„çš„ç›¸å¯¹æŽ’åº.js",
            "1154.ä¸€å¹´ä¸­çš„ç¬¬å‡ å¤©.js",
            "1184.å…¬äº¤ç«™é—´çš„è·ç¦».js",
            "1200.æœ€å°ç»å¯¹å·®.js",
            "1640.èƒ½å¦è¿žæŽ¥å½¢æˆæ•°ç»„.js",
            "1678.è®¾è®¡-goal-è§£æžå™¨.js",
            "2078.ä¸¤æ ‹é¢œè‰²ä¸åŒä¸”è·ç¦»æœ€è¿œçš„æˆ¿å­.js",
            "2180.ç»Ÿè®¡å„ä½æ•°å­—ä¹‹å’Œä¸ºå¶æ•°çš„æ•´æ•°ä¸ªæ•°.js",
            "2231.æŒ‰å¥‡å¶äº¤æ¢åŽçš„æœ€å¤§æ•°å­—.js",
            "2235.ä¸¤æ•´æ•°ç›¸åŠ .js",
            "2239.æ‰¾åˆ°æœ€æŽ¥è¿‘-0-çš„æ•°å­—.js",
            "2243.è®¡ç®—å­—ç¬¦ä¸²çš„æ•°å­—å’Œ.js",
            "2374.è¾¹ç§¯åˆ†æœ€é«˜çš„èŠ‚ç‚¹.js",
            "2390.ä»Žå­—ç¬¦ä¸²ä¸­ç§»é™¤æ˜Ÿå·.js",
            "2414.æœ€é•¿çš„å­—æ¯åºè¿žç»­å­å­—ç¬¦ä¸²çš„é•¿åº¦.js",
            "2624.èœ—ç‰›æŽ’åº.js",
            "2625.æ‰å¹³åŒ–åµŒå¥—æ•°ç»„.js",
            "2628.å®Œå…¨ç›¸ç­‰çš„-JSON-å­—ç¬¦ä¸².js",
            "2649.åµŒå¥—æ•°ç»„ç”Ÿæˆå™¨.js",
            "2705.ç²¾ç®€å¯¹è±¡.js",
            "6041.å¤šä¸ªæ•°ç»„æ±‚äº¤é›†.js"
          ]
          // Array.from(dom.getElementsByTagName('li')).flatMap((li, index) => {
          //   if (index === 0) return []
          //   const name = li.getElementsByClassName('name')[0].innerHTML
          //   return [name]
          // }).sort((a, b) => {
          //   const [a_index] = a.split('.')
          //   const [b_index] = b.split('.')
          //   return Number(a_index) - Number(b_index)
          // })
          // console.log(this.store.menus);

          this.toggle(this.store.menus[0])
        },
        proto: {
          toggle(title) {
            this.store.currTitle = title
            const currIndex = this.store.menus.indexOf(title)
            this.store.preTitle = this.store.menus[currIndex - 1] ?? ''
            this.store.nextTitle = this.store.menus[currIndex + 1] ?? ''
          }
        }
      }
    }
  </script>
</template>