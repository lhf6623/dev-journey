<template component>
  <input
    placeholder="快速查询"
    list="menus"
    :value="inputValue"
    on:change="toggle"
    b="solid 1px menu-border"
    class="caret-transparent relative w-168px box-border px-6px py-0px rounded placeholder:text-12px"
  />
  <datalist id="menus">
    <x-fill :value="sys_store.menus">
      <option :value="$data" class="bg-red" />
    </x-fill>
  </datalist>
  <script type="module">
    const menu = "l-menu";
    export const tag = "l-search";
    export default async function ({ load }) {
      const { sys_store } = await load("../js/sys_store.js");
      return {
        data: {
          sys_store: {},
          inputValue: "",
        },
        attached() {
          this.sys_store = sys_store;
        },
        detached() {
          this.sys_store = null;
        },
        proto: {
          toggle(e) {
            const _title = e.target.value.trim();
            if (!_title) return;

            const inMenu = this.sys_store.menus.reduce((pre, curr) => {
              if (pre === true) return pre;
              return curr === _title;
            }, false);
            if (!inMenu) return;

            this.inputValue = e.target.value;
            this.sys_store.title = _title;
            this.inputValue = "";
          },
        },
      };
    }
  </script>
</template>
